"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseDoujinList = void 0;
const List_1 = require("../lib/Classes/List");
const lib_1 = require("../lib");
const parseDoujinList = ($, site) => {
    const data = [];
    const baseURL = lib_1.baseURLS[site];
    let currentPage = 1;
    let totalPages = 1;
    const pageElements = site === 'to'
        ? $('body > section')
        : site === 'xxx'
            ? $('#content > section')
            : $('#fnh > section');
    if (pageElements.find('.page.current').html()) {
        currentPage = Number(pageElements.find('.page.current').text());
        const split = $(pageElements)
            .last()
            .text()
            .split('\n')
            .filter((el) => Number(el) >= 1);
        totalPages = Number(split[split.length - 1]);
    }
    const pagination = {
        currentPage,
        hasNextPage: totalPages > currentPage,
        totalPages
    };
    $('.gallery').each((i, el) => {
        const contentElements = $(el).find('a');
        const slug = contentElements.attr('href');
        const id = slug ? slug.split('g/')[1].replace('/', '') : '';
        const url = `${baseURL}/g/${id}`;
        const coverSlug = contentElements.find('img').attr('data-src');
        const cover = coverSlug
            ? `${coverSlug.startsWith('/galleries/')
                ? 'https://t3.nhentai.net'
                : ''}${coverSlug}`
                .replace('/g/', '/galleries/')
                .replace(lib_1.imageSites[site], 't3.nhentai.net')
            : null;
        const title = $(el).find('.caption').text().trim();
        data.push(new List_1.List(title, id, cover, url));
    });
    return {
        pagination,
        data
    };
};
exports.parseDoujinList = parseDoujinList;
